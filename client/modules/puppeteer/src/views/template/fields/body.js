"use strict";var A=Object.defineProperty;var E=(s,e,t)=>e in s?A(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var u=(s,e,t)=>(E(s,typeof e!="symbol"?e+"":e,t),t),m=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var c=(s,e,t)=>(m(s,e,"read from private field"),t?t.call(s):e.get(s)),d=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},g=(s,e,t,r)=>(m(s,e,"write to private field"),r?r.call(s,t):e.set(s,t),t);var f=(s,e,t)=>new Promise((r,p)=>{var n=a=>{try{i(t.next(a))}catch(o){p(o)}},l=a=>{try{i(t.throw(a))}catch(o){p(o)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(n,l);i((t=t.apply(s,e)).next())});define(["views/template/fields/body","views/fields/text"],(s,e)=>{var t,r,h,n;return n=class extends s{constructor(){super(...arguments);d(this,r);d(this,t,void 0);u(this,"defaultHeight",400)}init(){const i=c(this,r,h);switch(i!=="Default"&&(this.editTemplate="puppeteer:template/fields/body/edit-"+Espo.Utils.camelCaseToHyphen(i)),i){case"Raw":case"Ace":e.prototype.init.call(this);return}super.init()}setup(){switch(c(this,r,h)){case"Raw":e.prototype.setup.call(this);return;case"Ace":this.setupAceEditor();return}super.setup()}setupAceEditor(){e.prototype.setup.call(this),this.params.height=this.params.height||this.defaultHeight,this.wait(this.requireAce()),this.once("remove",()=>{this.destroyAce()}),this.on("inline-edit-off",()=>{this.destroyAce()}),this.on("render",()=>{this.destroyAce()})}data(){const i=super.data();return i.height=this.params.height,i}afterRender(){if(!this.isEditMode()){super.afterRender();return}switch(c(this,r,h)){case"Raw":e.prototype.afterRender.call(this);return;case"Ace":e.prototype.afterRender.call(this),this.createAce();return}super.afterRender()}fetch(){var i;switch(c(this,r,h)){case"Raw":return e.prototype.fetch.call(this);case"Ace":return{[this.name]:((i=c(this,t))==null?void 0:i.getValue())||""}}return super.fetch()}requireAce(){return f(this,null,function*(){yield Espo.loader.requirePromise("lib!ace"),yield Espo.loader.requirePromise("lib!ace-mode-html"),yield Espo.loader.requirePromise("lib!ace-ext-language_tools"),this.getThemeManager().getParam("isDark")&&(yield Espo.loader.requirePromise("lib!ace-theme-tomorrow_night"))})}createAce(){this.destroyAce();const i={value:this.model.get(this.name)||""};this.getThemeManager().getParam("isDark")&&(i.theme="ace/theme/tomorrow_night");const a=g(this,t,ace.edit(this.$element.get(0),i));a.commands.removeCommand("find");const o=a.getSession();o.setUseWorker(!1),o.on("change",()=>{this.trigger("change")});const y=ace.require("ace/mode/html").Mode;return o.setMode(new y),a}destroyAce(){var i;(i=c(this,t))==null||i.destroy()}},t=new WeakMap,r=new WeakSet,h=function(){return this.options.type||this.model.get("type")||this.model.getFieldParam("type","default")},n});
